export ZSH="$HOME/.oh-my-zsh"
source /opt/homebrew/share/zsh-history-substring-search/zsh-history-substring-search.zsh
source /opt/homebrew/opt/zsh-fast-syntax-highlighting/share/zsh-fast-syntax-highlighting/fast-syntax-highlighting.plugin.zsh
source /opt/homebrew/share/zsh-you-should-use/you-should-use.plugin.zsh

MAGIC_ENTER_GIT_COMMAND='gss'
MAGIC_ENTER_OTHER_COMMAND='ls'

# Brew
eval "$(/opt/homebrew/bin/brew shellenv)"

plugins=(
  aliases
  aws
  brew
  colored-man-pages
  docker
  docker-compose
  encode64
  extract
  genpass
  gh
  git-commit
  git-extras
  git
  gitignore
  golang
  helm
  httpie
  kubectl
  macos
  magic-enter
  ssh
  starship
  tailscale
  terraform
  tig
  vscode
  z
  history-substring-search
)

# Brew completions
FPATH="$(brew --prefix)/share/zsh/site-functions:${FPATH}"

# OMZ
source $ZSH/oh-my-zsh.sh

# Exports
export LANG=en_US.UTF-8
export EDITOR='nvim'
export WORKON_HOME=$HOME/.virtualenvs
export PIP_REQUIRE_VIRTUALENV=true
export VIRTUAL_ENV_DISABLE_PROMPT=1
export PIP_DOWNLOAD_CACHE=$HOME/.pip/cache
export VIRTUALENVWRAPPER_PYTHON='/opt/homebrew/bin/python3'
export VIRTUALENVWRAPPER_VIRTUALENV='/opt/homebrew/bin/virtualenv'
export GPG_TTY="$(tty)"
export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)
export PAGER="bat -p"
export XDG_CONFIG_HOME=$HOME/.config
export YSU_MESSAGE_POSITION="after"

export PATH="$PATH:$HOME/.dotfiles"
export PATH="$PATH:$HOME/.local/bin"
export PATH="$PATH:$HOME/go/bin"
export PATH="$PATH:$HOME/.krew/bin"
export PATH="$PATH:$(npm get prefix -g)/bin"
export PATH="/opt/homebrew/opt/postgresql@17/bin:$PATH"


#Alias
alias ggr="git graph"
alias ggra="git graph --all"
alias gua="git unadd"
alias gcm="git commit -m"
alias yolo='git commit -m "$(curl -s http://whatthecommit.com/index.txt)"'
alias gcf='git commit --amend --reuse-message=HEAD'
alias al="alias | grep"
alias alf="alias | fzf"
alias k=kubectl
alias kb=kubectl
alias kcuc="kubectl config use-context"
alias kcn="kubectl config set-context --current --namespace"
alias ldk="lazydocker"
alias sl="ls"
alias cat=bat
alias addr="http -b https://ifconfig.co/json"
alias rnt='airnity'
alias vim="nvim"
alias vi="nvim"
alias dev="docker compose -f dev.compose.yaml"
alias devr="dev run --rm --remove-orphans --service-ports"
alias deve="dev exec"
alias devd="dev down --remove-orphans"

# GPG
gpgconf --launch gpg-agent

# Virtualenvwrapper
source /opt/homebrew/bin/virtualenvwrapper_lazy.sh

# Nodenv
command -v nodenv &>/dev/null && eval "$(nodenv init -)"

# Airnity cli
command -v airnity &>/dev/null && { source <(airnity completion zsh); compdef _airnity airnity; }

# History substring
bindkey '^p' history-substring-search-up

[[ -f "$(brew --prefix)/share/google-cloud-sdk/path.zsh.inc" ]] && source "$(brew --prefix)/share/google-cloud-sdk/path.zsh.inc"
[[ -f "$(brew --prefix)/share/google-cloud-sdk/completion.zsh.inc" ]] && source "$(brew --prefix)/share/google-cloud-sdk/completion.zsh.inc"

# Task Master aliases
alias tm='task-master'
alias taskmaster='task-master'


# Airnity
alias aic="rnt ai-commit"

# Local Dev
export DEV_DOMAIN=aledit.u.airnity.private
dcc() {
    local dir="$PWD"
    while [[ "$dir" != "/" ]]; do
        local compose_file=$(find "$dir" -maxdepth 4 -type f \( -name '*compose*.yml' -o -name '*compose*.yaml' \) 2>/dev/null | head -1)
        if [[ -n "$compose_file" ]]; then
            docker compose --project-directory . -f "$compose_file" "$@"
            return $?
        fi
        dir="$(dirname "$dir")"
    done
    docker compose "$@"
}

# Functions â€” unalias docker-compose plugin shortcuts we override
unalias dc dcd dcu dcr dce 2>/dev/null
dc() { dcc "$@"; }
dcd() { dcc down --remove-orphans "$@"; }
dcu() { dcc up -d "$@"; }
dcr() { dcc run --rm --remove-orphans --service-ports "$@"; }
dce() { dcc exec "$@"; }
